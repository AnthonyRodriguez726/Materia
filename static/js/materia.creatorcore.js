(function(){Namespace("Materia").CreatorCore=function(){var alert,cancelSave,disableResizeInterval,escapeScriptTags,getMediaUrl,save,setHeight,showMediaImporter,start,_baseurl,_creatorClass,_initExistingWidget,_initNewWidget,_lastHeight,_onPostMessage,_resizeInterval,_sendPostMessage,_tellCreator;return _baseurl=null,_creatorClass=null,_resizeInterval=null,_lastHeight=-1,_onPostMessage=function(e){var msg;switch(msg=JSON.parse(e.data),msg.type){case"initNewWidget":return _initNewWidget(msg.data[0],msg.data[1]);case"initExistingWidget":return _initExistingWidget(msg.data[0],msg.data[1],msg.data[2],msg.data[3],msg.data[4]);case"onRequestSave":return _tellCreator("onSaveClicked",[msg.data[0]]);case"onSaveComplete":return _tellCreator("onSaveComplete",[msg.data[0],msg.data[1],msg.data[2],msg.data[3]]);case"onMediaImportComplete":return _tellCreator("onMediaImportComplete",[msg.data[0]]);case"onQuestionImportComplete":return _tellCreator("onQuestionImportComplete",[msg.data[0]]);default:return alert("Error, unknown message sent to creator core: "+msg.type)}},_tellCreator=function(method,args){return"function"==typeof _creatorClass[method]?_creatorClass[method].apply(void 0,args):alert("Error, missing creator "+method+" called.")},_sendPostMessage=function(type,data){return parent.postMessage(JSON.stringify({type:type,data:data}),"*")},_initNewWidget=function(widget,baseUrl){return _baseurl=baseUrl,_tellCreator("initNewWidget",[widget])},_initExistingWidget=function(widget,title,qset,qsetVersion,baseUrl){return _baseurl=baseUrl,_tellCreator("initExistingWidget",[widget,title,qset,qsetVersion])},start=function(creatorClass){return"undefined"!=typeof addEventListener&&null!==addEventListener?addEventListener("message",_onPostMessage,!1):"undefined"!=typeof attachEvent&&null!==attachEvent&&attachEvent("onmessage",_onPostMessage),null!=creatorClass.manualResize&&creatorClass.manualResize===!1&&(_resizeInterval=setInterval(function(){return setHeight()},300)),_creatorClass=creatorClass,_sendPostMessage("start",null)},alert=function(title,msg,type){return null==type&&(type=1),_sendPostMessage("alert",{title:title,msg:msg,type:type})},getMediaUrl=function(mediaId){return _baseurl+"media/"+mediaId},showMediaImporter=function(){return _sendPostMessage("showMediaImporter",null)},save=function(title,qset,version){return null==version&&(version="1"),_sendPostMessage("save",[title,qset,version])},cancelSave=function(msg){return _sendPostMessage("cancelSave",[msg])},setHeight=function(h){return h||(h=$("html").height()),h!==_lastHeight?(_sendPostMessage("setHeight",[h]),_lastHeight=h):void 0},escapeScriptTags=function(text){return text.replace(/</g,"&lt;").replace(/>/g,"&gt;")},disableResizeInterval=function(){return clearInterval(_resizeInterval)},{start:start,alert:alert,getMediaUrl:getMediaUrl,showMediaImporter:showMediaImporter,cancelSave:cancelSave,save:save,disableResizeInterval:disableResizeInterval,setHeight:setHeight,escapeScriptTags:escapeScriptTags}}()}).call(this);