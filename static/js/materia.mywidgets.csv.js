(function(){Namespace("Materia.MyWidgets").Csv=function(){var AddRemoveSemesterToggle,buildPopup,checkAllToggle,chosenSemesters,enableDownload,getScores,init,inst_id,semesterArray,showOptions,updateScoreHeader;return semesterArray=["Spring","Summer","Fall"],inst_id=null,chosenSemesters=null,init=function(){},buildPopup=function(){return $(".csv_popup").hide(),getScores($(".gameSelected").attr("id").split("_")[1]),$(".download_options").css({left:$(".csv_popup").outerWidth(!0)}),$(".show_options").click(function(e){return e.preventDefault(),showOptions()}),$("#checkall").click(function(){return checkAllToggle(this)}),$(".csv_popup").fadeIn()},getScores=function(gameId){var $change,$dontChange;return inst_id=gameId,$dontChange=$(".download_options ul li:first-child"),$change=$dontChange.next(),Materia.Coms.Json.send("score_summary_get",[inst_id],function(summary){var $cloned,id,label,s,_i,_len;for(_i=0,_len=summary.length;_len>_i;_i++)s=summary[_i],$cloned=$change.clone(),label=s.year+" "+s.term,id=s.year+"_"+s.term,$cloned.children("input").attr("value",label).attr("id",id).end().children("label").html(label).attr("for",id),$change.before($cloned),$cloned.children("input").click(function(){return AddRemoveSemesterToggle(this)});return $dontChange.next().children("input").trigger("click"),$change.remove(),1===$(".semester").length&&($(".semester").attr("disabled","disabled"),$dontChange.remove()),AddRemoveSemesterToggle()})},checkAllToggle=function(element){var $element;return $element=$(element),$element.is(":checked")?($element.next().html(" - Uncheck all"),$(".semester:not(:checked)").each(function(){return $(this).trigger("click"),AddRemoveSemesterToggle(this)})):($(".semester:checked").each(function(){return $(this).trigger("click"),AddRemoveSemesterToggle(this)}),$element.next().html(" - Check all"))},AddRemoveSemesterToggle=function(){return chosenSemesters=[],$.each($("input.semester:checked"),function(){return chosenSemesters.push($(this).val())}),updateScoreHeader(),enableDownload(chosenSemesters.length>0)},updateScoreHeader=function(){var h4text,lastItem,semester,_i,_len;for(h4text=[],_i=0,_len=chosenSemesters.length;_len>_i;_i++)semester=chosenSemesters[_i],h4text.push(semester);switch(h4text.sort(function(a,b){var asplit,bsplit;return asplit=a.split(" "),bsplit=b.split(" "),asplit[0]-bsplit[0]===0?semesterArray.indexOf(asplit[1])-semesterArray.indexOf(bsplit[1]):asplit[0]-bsplit[0]}),h4text.reverse(),!1){case!(h4text.length>2):lastItem=h4text.pop(),h4text=h4text.join(", "),h4text+=" and "+lastItem;break;case 2!==h4text.length:h4text=h4text.join(", ");break;case!(h4text.length>0):h4text=h4text[0];break;default:h4text="(None Selected)"}return $(".download_wrapper h4").html(h4text)},showOptions=function(){return $(".download_options").show("slide",{direction:"left"}),$(".show_options").removeClass("show_options").addClass("hide_options").text("Hide").unbind("click").click(function(e){return e.preventDefault(),$(".download_options").hide("slide",{direction:"left"}),$(".hide_options").removeClass("hide_options").addClass("show_options").text("Semesters...").unbind("click").click(function(e){return e.preventDefault(),showOptions()})})},enableDownload=function(enable){return enable?$("#popup.csv_popup p.download a").removeClass("disabled").attr("href","/scores/csv/"+inst_id+"/"+chosenSemesters.join(",").replace(/\s/g,"-")).click(function(){return window.location=$(this).attr("href")}):$("#popup.csv_popup p.download a").addClass("disabled").attr("href","#")},{init:init,buildPopup:buildPopup}}()}).call(this);