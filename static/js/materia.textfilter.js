(function(){Namespace("Materia").TextFilter=function(){var MAX_ANIMATED_ITEMS,clearHighlights,clearSearch,highlight,lastSearch,renderSearch,search,searchDelay,searchDelayTimeoutId,setupInput,simplifyIndicies,zebraStripe;return MAX_ANIMATED_ITEMS=100,searchDelay=null,searchDelayTimeoutId=null,lastSearch="",clearHighlights=function($targetElements){return $targetElements.find(".highlighted").replaceWith(function(){return this.innerHTML})},highlight=function(searchString,selector){var found,multipleTerms,terms;return""===searchString?!0:(found=!1,terms=searchString.split(" "),multipleTerms=terms.length>1,$(selector).find(".searchable").each(function(){var $this,allTermsMatch,html,i,index,indicies,len,lowercaseHtml,newHtml,term,_i,_j,_len,_ref;if($this=$(this),html=$this.html(),lowercaseHtml=html.toLowerCase(),multipleTerms){for(indicies=[],allTermsMatch=!0,_i=0,_len=terms.length;_len>_i&&(term=terms[_i],index=lowercaseHtml.indexOf(term),index>-1);_i++)indicies.push([index,index+term.length]);if(indicies.length>0&&allTermsMatch){for(indicies=simplifyIndicies(indicies),len=indicies.length,newHtml="",i=_j=0,_ref=len-1;_ref>=0?_ref>=_j:_j>=_ref;i=_ref>=0?++_j:--_j)newHtml+=html.substring(0===i?0:indicies[i-1][1],indicies[i][0]),newHtml+="<span class='highlighted'>"+html.substring(indicies[i][0],indicies[i][1])+"</span>",i===len-1&&(newHtml+=html.substring(indicies[i][1]));return $this.html(newHtml),found=!0}}else if(index=lowercaseHtml.indexOf(terms[0]),index>-1)return $this.html(html.substring(0,index)+("<span class='highlighted'>"+html.substring(index,index+terms[0].length)+"</span>"+html.substring(index+terms[0].length))),found=!0}),found)},simplifyIndicies=function(indicies){var end,i,index,newIndicies,openIndex,pair,stackNumber,start,val,_i,_j,_len,_len1;for(pair=[],newIndicies=[],stackNumber=0,openIndex=0,_i=0,_len=indicies.length;_len>_i;_i++)index=indicies[_i],start=index[0],end=index[1],("function"==typeof pair[start]?pair[start](pair[start]++):void 0)||(pair[start]=1),null!=pair[end]?pair[end]--:pair[end]=-1;for(i=_j=0,_len1=pair.length;_len1>_j;i=++_j)val=pair[i],null!=val&&(0===stackNumber&&(openIndex=i),stackNumber+=val,0===stackNumber&&newIndicies.push([openIndex,i]));return newIndicies.sort(function(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:0}),newIndicies},search=function(searchValue,whatToSearch,animationType){var $whatToSearch,hits,misses;return searchValue=$.trim(searchValue.toLowerCase().replace(/,/g," ")),hits=[],misses=[],$whatToSearch=$(whatToSearch),clearHighlights($whatToSearch),$whatToSearch.each(function(){return highlight(searchValue,$(this))?hits.push(this):misses.push(this)}),renderSearch($(hits),$(misses),animationType),hits},clearSearch=function(whatToSearch,animationType){return search("",whatToSearch,animationType)},renderSearch=function($hits,$misses,animationType){switch(null==animationType&&(animationType="hide"),$hits.length+$misses.length>MAX_ANIMATED_ITEMS&&(animationType="quick"),animationType){case"fade":return $hits.fadeTo(200,function(){return zebraStripe()},1),$misses.fadeTo(200,function(){return zebraStripe()},.2);case"slide":return $hits.slideDown("fast",function(){return zebraStripe()}),$misses.slideUp("fast",function(){return zebraStripe()});case"quick":return $hits.css("display","block"),$misses.css("display","none"),zebraStripe();case"nozebra":return $hits.slideDown("fast"),$misses.slideUp("fast");case"hide":break;default:return $hits.show(),$misses.hide(),zebraStripe()}},zebraStripe=function(){var odd;return odd=!1,$(".widget_list").children(":visible").removeClass("odd").each(function(){var $this;return $this=$(this),"H2"!==$(this).get(0).nodeName&&(odd=!odd)?$this.addClass("odd"):void 0})},setupInput=function(input,callback,_searchDelay){var $closeX,$element;return $element=$(input),null==callback&&(callback=$.noop),searchDelay=null==_searchDelay?0:_searchDelay,$closeX=$(".search-close"),$closeX.hide(),$closeX.click(function(){return $element.val("").trigger("keyup"),$(this).hide()}),$element.keyup(function(event){var val;return val=$element.val(),val!==lastSearch?(clearTimeout(searchDelayTimeoutId),0===searchDelay||0===val.length?callback(val):searchDelayTimeoutId=setTimeout(function(){return callback(val)},searchDelay)):27===event.keyCode&&(val="",$element.val(val).trigger("keyup")),0!==val.length?$closeX.show():$closeX.hide(),lastSearch=val})},{highlight:highlight,clearHighlights:clearHighlights,search:search,clearSearch:clearSearch,renderSearch:renderSearch,setupInput:setupInput,zebraStripe:zebraStripe}}()}).call(this);