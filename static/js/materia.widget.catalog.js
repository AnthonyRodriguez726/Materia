(function(){Namespace("Materia.Widget").Catalog=function(){var clean_name,prepare,removeInfocard,replaceDefault,showInfocard,tumbnail,widgets,_callback;return clean_name=null,tumbnail=null,_callback=null,widgets=null,prepare=function(callback){return _callback=callback,Materia.Coms.Json.send("widgets_get",null,function(data){return replaceDefault(data),$(".widget").mouseenter(function(){var card,pos;return pos=$(this).index(".widget"),card=Materia.Widget.Catalog.showInfocard(pos),null!=card?card.mouseleave(function(){return Materia.Widget.Catalog.removeInfocard()}):void 0})})},replaceDefault=function(widgetInfo){var $defaultContent,$defaultFeatures,$featuresClone,$featuresDt,$middleContent,$widgets,defaultSupported,feature,features,hideFeatures,middleHtml,project,supported,supportedClone,supportedDt,w,_i,_j,_k,_len,_len1,_len2,_ref,_ref1;for($widgets=$([]),Materia.Set.Throbber.startSpin(".page"),$defaultContent=$($("#t-widget-card").html()),_i=0,_len=widgetInfo.length;_len>_i;_i++){if(w=widgetInfo[_i],$middleContent=$defaultContent.clone(),hideFeatures=!0,$middleContent.find("h1").children("a").attr("href","/widgets/"+w.id+"-"+w.clean_name),$middleContent.addClass(w.clean_name),$middleContent.removeClass("hidden"),$middleContent.attr("id",w.ID),null!==w.meta_data.excerpt?$middleContent.find("dt[data-type=description]").next().html(w.meta_data.excerpt):$middleContent.find("dt[data-type=description]").next().html("No description available."),null!=w.meta_data.features&&w.meta_data.features.length>0){for(w.meta_data.features.sort(),$featuresDt=$middleContent.find("dt[data-type=features]"),$defaultFeatures=$featuresDt.next(),_ref=w.meta_data.features,_j=0,_len1=_ref.length;_len1>_j;_j++)feature=_ref[_j],$featuresClone=$defaultFeatures.clone(),$featuresClone.html(feature),$featuresDt.append($featuresClone);$defaultFeatures.remove()}else features=$middleContent.find("dt[data-type=features]"),$(features).next().remove(),$(features).remove();if(null!=w.meta_data.supported_data&&w.meta_data.supported_data.length>0){for(w.meta_data.supported_data.sort(),supportedDt=$middleContent.find("dt[data-type=supported]"),defaultSupported=supportedDt.next(),_ref1=w.meta_data.supported_data,_k=0,_len2=_ref1.length;_len2>_k;_k++)supported=_ref1[_k],supportedClone=defaultSupported.clone(),$(supportedClone).html(supported),$(supportedDt).append(supportedClone);$(defaultSupported).remove()}else supported=$middleContent.find("dt[data-type=supported]"),$(supported).next().remove(),$(supported).remove();null==w.meta_data.project&&(project=$middleContent.find("dt[data-type=project]"),$(project).next().html("General")),$middleContent.children(":first-child").attr("href","/widgets/"+w.id+"-"+w.clean_name),middleHtml=$middleContent.html(),middleHtml=middleHtml.replace(/_template_name/g,w.name),$middleContent.html(middleHtml),$($middleContent).children(":first-child").children(":first-child").attr("src",Materia.Image.iconUrl(w.dir,92)),$middleContent.removeClass("template"),$widgets=$widgets.add($middleContent)}return Materia.Set.Throbber.stopSpin(".page"),$(".template").remove(),null!=_callback?_callback($widgets):void 0},showInfocard=function(position){var $widget,cardContent,cardWidth,infocard,left,top;return isMobile.any()?null:($(".infocard").remove(),infocard=$("<div>").addClass("infocard"),$widget=$(".widget").eq(position),cardContent=$("<a>").addClass("card-content").attr("href",$widget.find("a:first").attr("href")),cardContent.append($widget.html()),cardContent.append($("<div>").addClass("clear")),infocard.append(cardContent),$(".catalog .widgets").append(infocard),cardWidth=$widget.width(),left=$widget.position().left,top=$widget.position().top+5,infocard.css({top:top,left:left,width:cardWidth}),infocard.hide().fadeIn("fast"),$(infocard))},removeInfocard=function(){return $(".infocard").fadeOut("fast").remove()},{prepare:prepare,replaceDefault:replaceDefault,showInfocard:showInfocard,removeInfocard:removeInfocard}}()}).call(this);