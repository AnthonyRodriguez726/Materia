(function(){Namespace("Materia.MyWidgets").Statistics=function(){var clearGraphs,createGraph,createTable,searchScores,tableOrder,_curTableOrder,_plots;return _curTableOrder="desc",_plots=[],createGraph=function(elementId,data){var i,jqOptions,plot,series,seriesData,_i,_len;if(null==_plots[elementId])return jqOptions={animate:!0,animateReplot:!0,series:[{renderer:$.jqplot.BarRenderer,shadow:!1,rendererOptions:{animation:{speed:500}}}],title:{text:"Score Distribution",fontFamily:"Lato, Lucida Grande, Arial, sans"},axesDefaults:{tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:0,fontSize:"8pt"}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:["0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80-89","90-100"]}},highlighter:{show:!0,showMarker:!1,sizeAdjust:7.5,tooltipAxes:"y",formatString:"%s scores"},cursor:{show:!1},grid:{background:"#FFFFFF",shadow:!1},seriesColors:["#1e91e1"]},plot=$.jqplot(elementId,[data],jqOptions),_plots[elementId]=plot;for(plot=_plots[elementId],seriesData=[],i=_i=0,_len=data.length;_len>_i;i=++_i)series=data[i],seriesData.push([i+1,series]);return plot.series[0].data=seriesData,plot.replot({resetAxes:!0})},clearGraphs=function(){return _plots=[]},createTable=function($tableContainer,log,sort){var $table,$userTable,$userTableBox,gameId,tableBody,userCount,users,usersFound;if(null==sort&&(sort="dec"),_curTableOrder=sort,gameId=$(".gameSelected").attr("id"),$table=$tableContainer.find(".scoreListTable"),$userTable=$tableContainer.find(".scoreTable"),$userTableBox=$tableContainer.find(".scoreTableContainer"),$table.html(""),$userTableBox.css("opacity",0),$userTable.html(""),tableBody=$("<tbody>"),$table.append(tableBody),log){switch(users=[],userCount=0,usersFound={},$.each(log,function(i,playLog){var name,uid;return uid=playLog.user_id,name=playLog.last+", "+playLog.first,null==usersFound[uid]&&(usersFound[uid]=users.length,users.push({uid:uid,name:name,scores:{}})),users[usersFound[uid]].scores[playLog.time.toString()]={date:new Date(1e3*playLog.time).toDateString(),percent:playLog.perc,elapsed:playLog.elapsed,complete:playLog.done}}),sort){case"desc":users.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:void 0});break;case"asc":users.sort(function(a,b){return a.name<b.name?1:a.name>b.name?-1:void 0})}return $.each(users,function(index,user){var $tr;return $tr=$("<tr id='"+index+"'></tr>"),$tr.append($("<td class='listName'>"+user.name+"</td>")),tableBody.append($tr),$tr.click(function(){var $userTableBody;return $(".rowSelected").removeClass("rowSelected"),$(this).addClass("rowSelected"),$userTableBox.stop(),$userTableBox.css({opacity:0,right:"0px"}),$userTable.html(""),$userTableBody=$("<tbody>"),$userTable.append($userTableBody),$.each(user.scores,function(j,score){var $userDateTd,$userElapsedTd,$userPctTd,$userTr,scoreMins,scoreSecs;return scoreMins=(score.elapsed-score.elapsed%60)/60,scoreSecs=score.elapsed%60,$userTr=$("<tr>"),$userDateTd=$("<td>").html(score.date.substring(0,10)),$userPctTd="1"===score.complete?$("<td>").html(""+parseFloat(score.percent).toFixed(2).replace(".00","")+"%"):$("<td>").html("---"),$userElapsedTd=0!==scoreMins?$("<td>").html(""+scoreMins+"m "+scoreSecs+"s"):$("<td>").html(""+scoreSecs+"s"),$userTr.append($userDateTd),$userTr.append($userPctTd),$userTr.append($userElapsedTd.addClass("elapsed")),$userTableBody.append($userTr)}),$userTableBox.css({opacity:1,right:"12px"})})})}},tableOrder=function(){return _curTableOrder},searchScores=function(search){var $hits,$names,hits,i,match,misses,term,terms,_i,_j,_len,_ref;for($names=$(".listName"),search=$.trim(search.toLowerCase().replace(/,/g," ")),hits=[],misses=[],terms=search.split(" "),i=_i=0,_ref=$names.length-1;_ref>=0?_ref>=_i:_i>=_ref;i=_ref>=0?++_i:--_i){for(match=!1,_j=0,_len=terms.length;_len>_j;_j++){if(term=terms[_j],!($names.eq(i).html().toLowerCase().indexOf(term)>-1)){match=!1;break}match=!0}match?hits.push($names.eq(i)[0]):misses.push($names.eq(i)[0])}return $hits=$(hits),Materia.TextFilter.renderSearch($hits,$(misses),"nozebra"),Materia.TextFilter.clearHighlights($(".listName")),$hits.each(function(){return Materia.TextFilter.highlight(search,$(this))})},{createGraph:createGraph,clearGraphs:clearGraphs,createTable:createTable,tableOrder:tableOrder,searchScores:searchScores}}()}).call(this);