// Generated by CoffeeScript 1.6.3
(function() {
  Namespace('Materia.MyWidgets').Sidebar = (function() {
    var buildDefaultList, getWidgetByURL, prepare, search, showWidgetCatNumbers;
    prepare = function() {
      return Materia.Widget.getWidgets(function(widgets) {
        var found, selID, widget, _i, _len;
        buildDefaultList(widgets);
        if (window.location.hash) {
          found = false;
          selID = window.location.hash.substr(1);
          for (_i = 0, _len = widgets.length; _i < _len; _i++) {
            widget = widgets[_i];
            if (widget.id === selID) {
              found = true;
              break;
            }
          }
          if (found) {
            return Materia.MyWidgets.SelectedWidget.setSelected(selID);
          } else {
            return Materia.MyWidgets.SelectedWidget.noAccess();
          }
        }
      });
    };
    buildDefaultList = function(widgets) {
      var bearded, len, rightSide;
      bearded = (typeof BEARD_MODE !== "undefined" && BEARD_MODE !== null) && BEARD_MODE === true;
      if (bearded) {
        $("div[data-template=widget-list] .icon").addClass('bearded');
      }
      len = widgets.length;
      rightSide = $('section.directions');
      if (len === 0) {
        Materia.MyWidgets.SelectedWidget.noWidgets();
      } else {
        rightSide.addClass('unchosen');
        Materia.Widget.sortWidgets();
        $('.courses').on('click', '.widget', function(event) {
          event.preventDefault();
          Materia.MyWidgets.SelectedWidget.setSelected($(this).attr('id').split('_')[1]);
          return false;
        });
        if (bearded) {
          $('.my_widgets aside .courses .course_list').css({
            overflow: 'visible'
          });
        }
      }
      return Materia.Set.Throbber.stopSpin('.courses');
    };
    showWidgetCatNumbers = function() {
      return $('.widget_list').each(function(i) {
        return $(this).prev().addClass('widget_list_category');
      });
    };
    search = function(searchString) {
      return Materia.Widget.getWidgets(function(widgets) {
        var $hits, hits, len, len2, match, misses, term, terms, widget, _i, _j, _len, _len1;
        searchString = $.trim(searchString.toLowerCase().replace(/,/g, ' '));
        hits = [];
        misses = [];
        terms = searchString.split(' ');
        len = widgets.length;
        len2 = terms.length;
        for (_i = 0, _len = widgets.length; _i < _len; _i++) {
          widget = widgets[_i];
          match = false;
          for (_j = 0, _len1 = terms.length; _j < _len1; _j++) {
            term = terms[_j];
            if (widget.searchCache.indexOf(term) > -1) {
              match = true;
            } else {
              match = false;
              break;
            }
          }
          if (match) {
            hits.push(widget.element);
          } else {
            misses.push(widget.element);
          }
        }
        $hits = $(hits);
        Materia.TextFilter.renderSearch($hits, $(misses), 'slide');
        Materia.TextFilter.clearHighlights($('.widget'));
        $hits.each(function() {
          return Materia.TextFilter.highlight(searchString, $(this));
        });
        return Materia.TextFilter.zebraStripe();
      });
    };
    getWidgetByURL = function() {
      var newHash, tar, widgetID;
      newHash = window.location.hash;
      widgetID = newHash.substr(1);
      if (!newHash) {
        return false;
      }
      tar = $('#widget_' + widgetID);
      if (tar.length > 0) {
        tar.trigger('click');
      } else {
        Materia.MyWidgets.SelectedWidget.noAccess();
      }
      return false;
    };
    return {
      prepare: prepare,
      showWidgetCatNumbers: showWidgetCatNumbers,
      search: search,
      getWidgetByURL: getWidgetByURL
    };
  })();

}).call(this);
